<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>皮克敏助手 | 1月賀歲任務版</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans TC"', '"Outfit"', 'sans-serif'],
                        display: ['"Outfit"', '"Noto Sans TC"', 'sans-serif'],
                    },
                    colors: {
                        primary: '#a94438', // 質感磚紅
                        'primary-light': '#fdf2f1',
                        accent: '#3a4a61', // 靜謐灰藍
                        base: '#0f0f0f',   // 深邃黑
                        surface: '#ffffff',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --color-primary: #a94438;
            --color-primary-light: #fdf2f1;
            --mask-gradient: linear-gradient(to top, #ffffff 0%, rgba(255,255,255,0.2) 60%, rgba(255,255,255,0) 100%);
        }

        body {
            background-color: #f8fafc;
            color: #1e293b;
            font-family: 'Noto Sans TC', sans-serif;
            transition: all 0.5s ease;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .hero-mask { background: var(--mask-gradient); }
        .card-shadow { box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.08); }
        .glass-nav { 
            background: rgba(255, 255, 255, 0.8); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.6); 
        }
        
        .accordion-content {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 0; opacity: 0; overflow: hidden;
        }
        .accordion-content.open { max-height: 4000px; opacity: 1; }

        .btn-active-scale:active { transform: scale(0.95); }
        
        /* 自定義捲軸 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const EVENTS = {
            jan2026: {
                id: 'jan2026',
                name: '1月 賀歲新篇',
                heroImage: 'https://lh3.googleusercontent.com/nBKEDxRMfpBkfY9V87EJI-aWnW1S12VSVMIQDY9XjEcA6YAyJIU48BB2-AnmoMocqLcO4ZXYttZ5tiagYjmA5Nc-6dMcqS64F8M3qws=rw-e365-w2880',
                title: "繁花盛開",
                stages: [
                    { id: 1, title: "第一階段: 起步", tasks: [
                        { id: "j1-1", text: "走 1000 步" },
                        { id: "j1-2", text: "培育 2 隻皮克敏" },
                        { id: "j1-3", text: "種 1000 朵花", amount: 1000 },
                        { id: "j1-4", text: "摧毀 2 棵蘑菇" },
                    ]},
                    { id: 2, title: "第二階段: 探春", tasks: [
                        { id: "j2-1", text: "走 2000 步" },
                        { id: "j2-2", text: "摧毀 2 棵蘑菇" }, // 已根據圖片修正順序至第二位
                        { id: "j2-3", text: "種 1000 朵一般花", amount: 1000 },
                        { id: "j2-4", text: "種 500 朵蝴蝶蘭", amount: 500 },
                        { id: "j2-5", text: "摧毀 4 棵蘑菇" },
                    ]},
                    { id: 3, title: "第三階段: 爭豔", tasks: [
                        { id: "j3-1", text: "種 1500 朵白色山茶花", amount: 1500 },
                        { id: "j3-2", text: "摧毀 3 棵蘑菇" },
                        { id: "j3-3", text: "種 1500 朵紅色山茶花", amount: 1500 },
                        { id: "j3-4", text: "種 1500 朵黃色山茶花", amount: 1500 },
                        { id: "j3-5", text: "種 2000 朵紅色蝴蝶蘭", amount: 2000 },
                        { id: "j3-6", text: "摧毀 5 棵蘑菇" },
                    ]},
                    { id: 4, title: "第四階段: 新歲", tasks: [
                        { id: "j4-1", text: "完成 3 個探險" },
                        { id: "j4-2", text: "種 2000 朵白色蝴蝶蘭", amount: 2000 },
                        { id: "j4-3", text: "種 2000 朵黃色蝴蝶蘭", amount: 2000 },
                        { id: "j4-4", text: "種 1000 朵藍色山茶花", amount: 1000 },
                        { id: "j4-5", text: "種 2000 朵藍色蝴蝶蘭", amount: 2000 },
                        { id: "j4-6", text: "種 2500 朵山茶花", amount: 2500 },
                        { id: "j4-7", text: "摧毀 5 棵蘑菇" },
                    ]}
                ]
            }
        };

        const Icons = {
            Reset: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>,
            Chevron: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="3"><path strokeLinecap="round" strokeLinejoin="round" d="M19 9l-7 7-7-7" /></svg>,
            Check: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="3"><path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" /></svg>,
            Timer: () => <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            Menu: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
        };

        const App = () => {
            const [squadSize, setSquadSize] = useState(() => Number(localStorage.getItem('pikmin_squad_v9')) || 40);
            const [completedTasks, setCompletedTasks] = useState(() => JSON.parse(localStorage.getItem('pikmin_tasks_v9')) || {});
            const [expanded, setExpanded] = useState({ 1: true });
            const [showResetConfirm, setShowResetConfirm] = useState(false);

            useEffect(() => {
                localStorage.setItem('pikmin_squad_v9', squadSize);
                localStorage.setItem('pikmin_tasks_v9', JSON.stringify(completedTasks));
            }, [squadSize, completedTasks]);

            const currentEvent = EVENTS.jan2026;
            
            const calculateReq = (amount) => {
                const density = Math.floor(squadSize * 0.3); // 步行係數 0.3
                const petals = Math.ceil(amount / density);
                const minutes = Math.ceil(petals / 2); // 基礎每分鐘 2 片
                return { petals, minutes };
            };

            const toggleTask = (id) => setCompletedTasks(prev => ({ ...prev, [id]: !prev[id] }));

            const clearAllTasks = () => {
                setCompletedTasks({});
                setShowResetConfirm(false);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const progressPercent = useMemo(() => {
                const tasks = currentEvent.stages.flatMap(s => s.tasks);
                const done = tasks.filter(t => completedTasks[t.id]).length;
                return Math.round((done / tasks.length) * 100);
            }, [completedTasks]);

            return (
                <div className="min-h-screen pb-40">
                    
                    {/* --- 重置確認彈窗 --- */}
                    {showResetConfirm && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-base/80 backdrop-blur-md">
                            <div className="bg-white rounded-[2.5rem] p-8 max-w-sm w-full shadow-2xl text-center border border-gray-100">
                                <div className="w-16 h-16 bg-primary-light rounded-2xl flex items-center justify-center mb-6 mx-auto text-primary">
                                    <Icons.Reset />
                                </div>
                                <h3 className="text-2xl font-black text-gray-800 mb-2">重置所有進度？</h3>
                                <p className="text-gray-400 text-sm mb-8 font-medium">目前的打勾記錄將被清除。</p>
                                <div className="flex gap-3">
                                    <button onClick={() => setShowResetConfirm(false)} className="flex-1 py-4 rounded-2xl bg-gray-100 text-gray-500 font-bold btn-active-scale">取消</button>
                                    <button onClick={clearAllTasks} className="flex-1 py-4 rounded-2xl bg-primary text-white font-bold shadow-lg shadow-primary/20 btn-active-scale">確定</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Hero Section */}
                    <div className="relative h-[48vh] min-h-[400px] w-full overflow-hidden">
                        <img 
                            src={currentEvent.heroImage} 
                            className="absolute inset-0 w-full h-full object-cover transition-transform duration-[10s] hover:scale-110"
                            alt="Jan Event"
                        />
                        <div className="absolute inset-0 hero-mask" />
                        
                        <div className="relative z-10 h-full max-w-4xl mx-auto px-6 flex flex-col justify-end pb-12">
                            <div className="flex justify-between items-center mb-6">
                                <div className="px-4 py-1.5 bg-primary text-white text-[10px] font-black tracking-[0.2em] rounded-full shadow-xl shadow-primary/20">
                                    {currentEvent.name}
                                </div>
                                <button 
                                    onClick={() => setShowResetConfirm(true)}
                                    className="w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/20 shadow-lg btn-active-scale"
                                >
                                    <Icons.Reset />
                                </button>
                            </div>
                            <h1 className="text-5xl md:text-7xl font-display font-black text-gray-800 tracking-tighter leading-tight">
                                {currentEvent.title}
                            </h1>
                            <div className="mt-6 flex items-center gap-4">
                                <div className="flex-1 max-w-[240px] h-2 bg-gray-200/50 rounded-full overflow-hidden">
                                    <div className="bg-primary h-full transition-all duration-1000" style={{width: `${progressPercent}%`}} />
                                </div>
                                <span className="text-[10px] font-black text-primary uppercase tracking-widest">{progressPercent}% DONE</span>
                            </div>
                        </div>
                    </div>

                    {/* Task List */}
                    <main className="px-6 space-y-4 max-w-2xl mx-auto -mt-6 relative z-20">
                        {currentEvent.stages.map(stage => (
                            <div key={stage.id} className="bg-white rounded-[2.5rem] overflow-hidden card-shadow">
                                <div 
                                    onClick={() => setExpanded(p => ({...p, [stage.id]: !p[stage.id]}))}
                                    className={`p-6 flex justify-between items-center cursor-pointer transition-colors ${expanded[stage.id] ? 'bg-primary-light/30' : 'hover:bg-gray-50'}`}
                                >
                                    <div className="flex items-center gap-4">
                                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-black transition-all ${expanded[stage.id] ? 'bg-primary text-white rotate-3 shadow-lg' : 'bg-gray-100 text-gray-300'}`}>
                                            {stage.id}
                                        </div>
                                        <div>
                                            <h2 className={`font-black text-lg ${expanded[stage.id] ? 'text-primary' : 'text-gray-700'}`}>{stage.title}</h2>
                                            <p className="text-[10px] text-gray-400 font-bold uppercase tracking-widest">{stage.tasks.length} 項目</p>
                                        </div>
                                    </div>
                                    <div className={`transition-transform duration-500 ${expanded[stage.id] ? 'rotate-180 text-primary' : 'text-gray-300'}`}><Icons.Chevron /></div>
                                </div>
                                <div className={`accordion-content ${expanded[stage.id] ? 'open' : ''} p-4 space-y-2.5`}>
                                    {stage.tasks.map(t => {
                                        const req = t.amount ? calculateReq(t.amount) : null;
                                        const isDone = completedTasks[t.id];
                                        return (
                                            <div 
                                                key={t.id} onClick={() => toggleTask(t.id)}
                                                className={`p-5 rounded-[1.8rem] border-2 transition-all cursor-pointer ${isDone ? 'bg-gray-50 border-transparent opacity-40' : 'bg-white border-gray-100 hover:border-primary/20'}`}
                                            >
                                                <div className="flex items-start gap-4">
                                                    <div className={`mt-1 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${isDone ? 'bg-primary border-primary text-white shadow-lg' : 'border-gray-200'}`}>
                                                        {isDone && <Icons.Check />}
                                                    </div>
                                                    <div className="flex-1">
                                                        <p className={`font-bold text-sm ${isDone ? 'line-through text-gray-400' : 'text-gray-800'}`}>{t.text}</p>
                                                        {req && !isDone && (
                                                            <div className="mt-3 flex gap-2">
                                                                <span className="text-[9px] font-black bg-primary-light text-primary px-2.5 py-1 rounded-lg uppercase tracking-wider">需 {req.petals} 花瓣</span>
                                                                <span className="text-[9px] font-black bg-gray-100 text-gray-400 px-2.5 py-1 rounded-lg flex items-center gap-1 uppercase tracking-wider"><Icons.Timer />{req.minutes} MINS</span>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ))}
                    </main>

                    {/* --- 控制列 --- */}
                    <nav className="fixed bottom-10 left-1/2 -translate-x-1/2 w-[90%] max-w-md z-50">
                        <div className="glass-nav rounded-[2.5rem] p-3 flex items-center justify-between shadow-2xl">
                            <div className="w-12 h-12 flex items-center justify-center text-primary/30">
                                <Icons.Menu />
                            </div>
                            
                            {/* 置中控制器 */}
                            <div className="flex-1 px-4">
                                <div className="bg-gray-50/50 rounded-2xl p-1.5 flex items-center justify-between border border-gray-200/50">
                                    <button onClick={() => setSquadSize(s => Math.max(10, s-5))} className="w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center font-black text-primary active:scale-90 transition-all">-</button>
                                    <div className="flex flex-col items-center">
                                        <span className="text-xl font-display font-black text-gray-800 leading-none">{squadSize}</span>
                                        <span className="text-[8px] font-black text-gray-400 uppercase tracking-widest mt-1">隊伍規模</span>
                                    </div>
                                    <button onClick={() => setSquadSize(s => Math.min(40, s+5))} className="w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center font-black text-primary active:scale-90 transition-all">+</button>
                                </div>
                            </div>

                            <div className="w-12 h-12 flex items-center justify-center">
                                <div className="w-2 h-2 bg-primary rounded-full animate-pulse" />
                            </div>
                        </div>
                    </nav>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
